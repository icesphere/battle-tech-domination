<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:btd="http://java.sun.com/jsf/composite/components">

<ui:composition template="/templates/commonLayout.xhtml">

    <ui:define name="head">
        <h:outputStylesheet name="game.css" library="css" />
    </ui:define>

    <ui:define name="content">
        <h:form>

            <div class="gamePage">

                <div class="leftSection">

                    <div class="baseCards">
                        <h:panelGroup rendered="#{!empty gameView.game.infantryPlatoons}">
                            <btd:supplyCard card="#{gameView.game.infantryPlatoons[0]}"/>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{!empty gameView.game.basicFactories}">
                            <btd:supplyCard card="#{gameView.game.basicFactories[0]}"/>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{!empty gameView.game.munitionsFactories}">
                            <btd:supplyCard card="#{gameView.game.munitionsFactories[0]}"/>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{!empty gameView.game.advancedFactories}">
                            <btd:supplyCard card="#{gameView.game.advancedFactories[0]}"/>
                        </h:panelGroup>
                    </div>

                    <div class="supplyGrid">
                        <ui:repeat value="#{gameView.game.supplyGrid}" var="card">
                            <btd:supplyCard card="#{card}"/>
                        </ui:repeat>
                    </div>

                    <div class="cardView">
                        Card View
                    </div>

                </div>

                <div class="middleSection">

                    <div class="overrunCards">
                        <btd:overrunCard cardsLeft="#{gameView.game.heavyCasualties.size()}" pileName="Heavy Casualties"/>
                        <btd:overrunCard cardsLeft="#{gameView.game.raidedSupplies.size()}" pileName="Raided Supplies"/>
                        <btd:overrunCard cardsLeft="#{gameView.game.criticalHits.size()}" pileName="Critical Hits"/>
                        <btd:overrunCard cardsLeft="#{gameView.game.retreats.size()}" pileName="Retreats"/>
                    </div>

                    <div class="playerInfoSection">

                        <btd:playerInfo player="#{gameView.player}" playerClass="player"/>

                        <btd:playerInfo player="#{gameView.opponent}" playerClass="opponent"/>

                    </div>

                    <div class="unitsSection">

                        <div class="yourUnitsSection player">
                            #{gameView.player.playerName}'s Units:
                            <div style="padding: 10px 0;">
                                <ui:repeat value="#{gameView.player.deploymentZone}" var="card">
                                    <btd:card card="#{card}"/>
                                </ui:repeat>
                            </div>
                        </div>

                        <div class="opponentUnitsSection opponent">
                            #{gameView.opponent.playerName}'s Units:
                            <div style="padding: 10px 0;">
                                <ui:repeat value="#{gameView.opponent.deploymentZone}" var="card">
                                    <btd:card card="#{card}"/>
                                </ui:repeat>
                            </div>
                        </div>

                    </div>

                    <div class="playAreaSection">
                        Play Area:
                        <div class="playArea">
                            <ui:repeat value="#{gameView.cardsForPlayArea}" var="card">
                                <btd:card card="#{card}"/>
                            </ui:repeat>
                        </div>
                    </div>

                    <div class="handSection">
                        Your Hand:
                        <div class="hand">
                            <ui:repeat value="#{gameView.player.hand}" var="card">
                                <btd:card card="#{card}"/>
                            </ui:repeat>
                        </div>
                    </div>

                </div>

                <div class="rightSection">

                    <div class="gameLog">
                        <h:outputText value="#{gameView.game.gameLog.toString()}"/>
                    </div>

                    <div class="playerCardInfoSection">
                        <div class="playerCardInfoBox">
                            <div class="playerCardInfoRow">
                                <div class="playerCardInfoNameContainer">&#160;</div>
                                <div class="playerCardInfoValue">Hand</div>
                                <div class="playerCardInfoValue">Deck</div>
                                <div class="playerCardInfoValue">Discard</div>
                            </div>
                            <div class="playerCardInfoRow">
                                <div class="playerCardInfoNameContainer player">
                                    <div class="playerCardInfoName">
                                        <h:outputText value="#{gameView.player.playerName}"/>
                                    </div>
                                </div>
                                <div class="playerCardInfoValue">#{gameView.player.hand.size()}</div>
                                <div class="playerCardInfoValue">#{gameView.player.deck.size()}</div>
                                <div class="playerCardInfoValue">#{gameView.player.discard.size()}</div>
                            </div>
                            <div class="playerCardInfoRow">
                                <div class="playerCardInfoNameContainer opponent">
                                    <div class="playerCardInfoName">
                                        <h:outputText value="#{gameView.opponent.playerName}"/>
                                    </div>
                                </div>
                                <div class="playerCardInfoValue">#{gameView.opponent.hand.size()}</div>
                                <div class="playerCardInfoValue">#{gameView.opponent.deck.size()}</div>
                                <div class="playerCardInfoValue">#{gameView.opponent.discard.size()}</div>
                            </div>
                        </div>
                    </div>

                    <div class="turnInfoSection">
                        Turn Info
                    </div>

                    <div class="turnButtons">
                        Turn Buttons
                    </div>

                </div>

            </div>

        </h:form>

        <p:socket onMessage="handleGameMessage" channel="/game/#{gameView.game.gameId}/#{userSession.user.username}" autoConnect="true" widgetVar='gameMessageSubscriber' />

        <script type="text/javascript">
            function handleGameMessage(message) {
                alert("received message from server");
                console.log("received message from server: ");
                console.log(message);
            }
        </script>
    </ui:define>

</ui:composition>
</html>